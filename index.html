<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI éˆæ€§å¡”ç¾…</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
    </script>
    <style>
        /* --- åŸºç¤è®Šæ•¸èˆ‡å…¨å±€è¨­å®š --- */
        :root { 
            --gold: #cd9d5d; 
            --dark-bg: #1a1a2e; 
            --card-bg: #16213e; 
        }
        
        body { 
            font-family: 'PingFang TC', sans-serif; 
            background: var(--dark-bg); 
            color: #e9e9e9; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            width: 100%; 
            min-height: 100vh; 
            overflow-x: hidden; 
        }

        .container { 
            max-width: 1200px; 
            width: 100%; 
            margin: 0 auto; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px 0; 
            box-sizing: border-box; 
        }
        
        /* é é¢åˆ‡æ›é‚è¼¯ï¼šé è¨­éš±è—ï¼Œ.active æ™‚é¡¯ç¤º */
        .page { display: none; width: 100%; flex-direction: column; align-items: center; }
        .active { display: flex; }

        /* --- æŠ½ç‰Œå€å„€å¼æ„Ÿæ¨£å¼ --- */
        #drawing-status { 
            font-size: 1.2em; 
            color: var(--gold); 
            margin: 15px 0; 
            font-weight: bold; 
            text-shadow: 0 0 10px rgba(0,0,0,0.8); 
            z-index: 100; 
        }

        .deck-container {
            position: relative; 
            width: 100%; 
            height: 650px; 
            margin-top: 10px;
            display: flex; 
            justify-content: center; 
            overflow: hidden;
            padding: 0 40px; 
            box-sizing: border-box;
        }

        /* ç‰ŒèƒŒç‰©ä»¶ */
        .card-back-item {
            position: absolute; 
            background-image: url('Cards/CardBacks.jpg');
            background-size: cover; 
            background-position: center; 
            border-radius: 6px;
            cursor: pointer; 
            transition: box-shadow 0.3s ease, filter 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            transform-origin: center center; 
        }

        .card-back-item:hover { filter: brightness(1.3); }

        /* è¢«é¸ä¸­æ™‚çš„åŸåœ°ç™¼å…‰æ•ˆæœ */
        .card-back-item.selected {
            border: 2px solid var(--gold);
            box-shadow: 0 0 30px rgba(205, 157, 93, 0.8), inset 0 0 10px var(--gold);
            filter: brightness(1.2);
        }

        /* --- ç¢ºèªå½ˆçª— (Modal) --- */
        .modal-overlay {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.85); 
            z-index: 2000; 
            justify-content: center; 
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card-bg); 
            border: 2px solid var(--gold); 
            padding: 40px; 
            border-radius: 20px;
            text-align: center; 
            max-width: 400px; 
            width: 85%; 
            box-shadow: 0 0 50px rgba(205, 157, 93, 0.3);
        }

        /* æ—‹è½‰è¼‰å…¥å‹•ç•« */
        .loader {
            display: none; 
            width: 40px; 
            height: 40px; 
            border: 4px solid rgba(205, 157, 93, 0.3);
            border-top: 4px solid var(--gold); 
            border-radius: 50%; 
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- UI å…ƒä»¶ (è¡¨å–®ã€æŒ‰éˆ•) --- */
        .setup-box { 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 12px; 
            border: 1px solid var(--gold); 
            width: 90%; 
            max-width: 500px; 
            box-sizing: border-box; 
        }

        input, select, textarea { 
            width: 100%; 
            padding: 12px; 
            margin-top: 8px; 
            border-radius: 8px; 
            border: 1px solid #444; 
            background: #0f3460; 
            color: white; 
            box-sizing: border-box; 
        }

        .checkbox-group { 
            margin-top: 10px; 
            display: flex; 
            align-items: center; 
            font-size: 0.9em; 
            color: #ccc; 
        }
        .checkbox-group input { width: auto; margin-top: 0; margin-right: 8px; cursor: pointer; }

        button.primary { 
            background: var(--gold); 
            color: #1a1a2e; 
            font-weight: bold; 
            padding: 15px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 20px; 
            font-size: 1.1em; 
            transition: 0.3s; 
        }
        button.primary:disabled { background: #444; color: #888; cursor: not-allowed; }

        .prompt-btn { 
            background: #0f3460; 
            border: 1px solid var(--gold); 
            color: var(--gold); 
            padding: 8px 14px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-size: 0.85em; 
            margin: 10px 5px 0 0; 
            display: inline-block; 
        }

        /* --- çµæœé å¡ç‰Œï¼šä¿®æ­£ RWD æ–‡å­—æ¶ˆå¤± --- */
        .card-display { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin: 20px 0; 
            flex-wrap: wrap; 
            width: 100%; 
        }

        .tarot-card { 
            width: 200px; 
            height: 350px; 
            border: 2px solid var(--gold); 
            border-radius: 12px; 
            background: #000; 
            overflow: hidden; 
            position: relative; 
            cursor: pointer; 
        }

        .tarot-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.3; transition: 0.4s; }
        .tarot-card img.is-reversed { transform: rotate(180deg); }

        .card-content { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            padding: 15px; 
            box-sizing: border-box; 
            z-index: 2; 
            background: rgba(0, 0, 0, 0.7); 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; /* æ–‡å­—ç”±é ‚éƒ¨é–‹å§‹ï¼Œé˜²æ­¢å°ç•«é¢æ¶ˆå¤± */
            align-items: center; 
            overflow-y: auto; 
            text-align: center; 
        }

        .tarot-card.revealed img { opacity: 1.0; }
        .tarot-card.revealed .card-content { opacity: 0; pointer-events: none; }

        /* åº•éƒ¨è§£æå€åŸŸ */
        #interpretation-area { 
            background: #0f3460; 
            padding: 25px; 
            border-radius: 12px; 
            border: 1px solid #333; 
            margin: 20px auto; 
            width: 95%; 
            max-width: 850px; 
            box-sizing: border-box; 
        }

        .section-header { 
            color: var(--gold); 
            border-bottom: 1px solid var(--gold); 
            padding: 10px 0; 
            margin: 15px 0; 
            font-size: 1.2em; 
            font-weight: bold; 
            text-align: center; 
        }

        /* æ‰‹æ©Ÿç‰ˆé©é…å¾®èª¿ */
        @media (max-width: 600px) {
            .tarot-card { width: 44%; height: 260px; }
            .card-title { font-size: 1.4em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <section id="setup-page" class="page active">
            <h1 style="text-align: center; color: var(--gold); margin-bottom: 10px;">ğŸ”® AI éˆæ€§å¡”ç¾…</h1>
            <div class="setup-box">
                <div>
                    <label>Gemini API Key</label>
                    <input type="password" id="api-key" placeholder="åœ¨æ­¤è¼¸å…¥é‡‘é‘°...">
                    <div class="checkbox-group">
                        <input type="checkbox" id="remember-me"> 
                        <label for="remember-me">åœ¨æ­¤è£ç½®è¨˜ä½æˆ‘çš„ API Key</label>
                    </div>
                    <label style="color: red;font-size: small;">æ­¤åŠŸèƒ½å­˜åœ¨ä¸€å®šç¨‹åº¦é¢¨éšªï¼Œè«‹è©•ä¼°å¾Œå†ä½¿ç”¨</label>
                </div>
                <div style="margin-top:15px;">
                    <label>æ‚¨çš„å¿ƒä¸­æ‰€æ±‚</label>
                    <textarea id="user-question" rows="3" placeholder="è«‹æè¿°æ‚¨çš„å•é¡Œ..."></textarea>
                    <div>
                        <span class="prompt-btn" onclick="fillPrompt('ä»Šæ—¥ç¶œåˆé‹å‹¢')">âœ¨ ä»Šæ—¥é‹å‹¢</span>
                        <span class="prompt-btn" onclick="fillPrompt('è¿‘æœŸæ„Ÿæƒ…ç™¼å±•å»ºè­°')">â¤ï¸ æ„Ÿæƒ…ç™¼å±•</span>
                    </div>
                </div>
                <div style="margin-top:15px;">
                    <label>é¸æ“‡ç‰Œé™£</label>
                    <select id="spread-type">
                        <option value="3">è–ä¸‰è§’ (éå»ã€ç¾åœ¨ã€æœªä¾†)</option>
                        <option value="1">å–®ç‰ŒæŒ‡å¼•</option>
                    </select>
                </div>
                <button class="primary" onclick="startDrawingPhase()">é–‹å§‹å„€å¼</button>
                <div style="text-align: right;">
                    <button onclick="clearKey()" style="background:none; border:none; color:#888; text-decoration:underline; cursor:pointer; font-size:0.8em; margin-top:15px;">æ¸…é™¤ç´€éŒ„</button>
                </div>
            </div>
        </section>

        <section id="drawing-page" class="page">
            <h2 style="color: var(--gold); text-align: center; margin-bottom: 5px;">âœ¦ é€£çµç›´è¦ºï¼Œé¸å–ç‰Œå¡ âœ¦</h2>
            <div id="drawing-status">è¼‰å…¥ä¸­...</div>
            <div id="deck-container" class="deck-container"></div>
        </section>

        <section id="result-page" class="page">
            <h2 style="color: var(--gold); text-align: center; margin-bottom: 5px;">âœ¦ å‘½é‹å•Ÿç¤ºéŒ„ âœ¦</h2>
            <div id="card-display" class="card-display"></div>
            <div id="interpretation-area">ğŸ”® æ­£åœ¨æ„Ÿæ‡‰æ˜Ÿè±¡...</div>
            <div style="text-align: center;">
                <button onclick="location.reload()" style="background:none; color:var(--gold); border:1px solid var(--gold); padding:10px 25px; margin:20px 0; cursor:pointer; border-radius:8px;">é‡æ–°å åœ</button>
            </div>
        </section>
    </div>

    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color: var(--gold); margin-top: 0;">å„€å¼ç¢ºèª</h2>
            <p id="modal-text">æ‚¨å·²é¸å®šå‘½é‹ä¹‹å¡ï¼Œæº–å‚™å¥½æ­æ›‰å•Ÿç¤ºäº†å—ï¼Ÿ</p>
            <div id="modal-loader" class="loader"></div>
            <button id="modal-confirm-btn" class="primary" onclick="confirmAndInterpret()">ç¢ºèªæ­æ›‰</button>
            <button id="modal-cancel-btn" style="background:none; border:none; color:#888; text-decoration:underline; cursor:pointer; margin-top:15px;" onclick="closeModal()">è¿”å›ä¿®æ”¹</button>
        </div>
    </div>

    <script>
        /* --- è³‡æ–™å®šç¾©ï¼š78 å¼µç‰Œçµ„ --- */
        const MAJOR_ARCANA = ["æ„šè€…", "é­”è¡“å¸«", "å¥³æ•™çš‡", "å¥³çš‡", "çš‡å¸", "æ•™çš‡", "æˆ€äºº", "æˆ°è»Š", "åŠ›é‡", "éš±å£«", "å‘½é‹ä¹‹è¼ª", "æ­£ç¾©", "å€’åŠäºº", "æ­»ç¥", "ç¯€åˆ¶", "æƒ¡é­”", "é«˜å¡”", "æ˜Ÿæ˜Ÿ", "æœˆäº®", "å¤ªé™½", "å¯©åˆ¤", "ä¸–ç•Œ"];
        const SUITS = ["æ¬Šæ–", "è–æ¯", "å¯¶åŠ", "éŒ¢å¹£"];
        const RANKS = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å", "ä¾è€…", "é¨å£«", "çš‡å", "åœ‹ç‹"];
        let FULL_DECK = [...MAJOR_ARCANA];
        SUITS.forEach(s => RANKS.forEach(r => FULL_DECK.push(s + r)));

        let targetDrawCount = 0; // ç´€éŒ„éœ€è¦æŠ½å¹¾å¼µ
        let selectedIndices = []; // ç´€éŒ„é¸ä¸­çš„å¡ç‰‡ç´¢å¼• (å°æ‡‰ shuffledIndices)
        let shuffledIndices = []; // éš¨æ©Ÿæ´—éçš„ 0~77 ç´¢å¼•

        /* --- åˆå§‹åŒ–åŠŸèƒ½ --- */
        window.onload = () => {
            const savedKey = localStorage.getItem("gemini_api_key");
            if (savedKey) { 
                document.getElementById("api-key").value = savedKey; 
                document.getElementById("remember-me").checked = true; 
            }
        };

        function fillPrompt(t) { document.getElementById('user-question').value = t; }
        function clearKey() { localStorage.removeItem("gemini_api_key"); location.reload(); }
        function closeModal() { document.getElementById("confirm-modal").style.display = "none"; }
        function toggleCard(el) { el.classList.toggle("revealed"); }

        /* --- æµç¨‹åˆ‡æ›ï¼šé€²å…¥æŠ½ç‰Œéšæ®µ --- */
        function startDrawingPhase() {
            const apiKey = document.getElementById("api-key").value.trim();
            const question = document.getElementById("user-question").value.trim();
            if (!apiKey || !question) return alert("è«‹å®Œæ•´å¡«å¯«è³‡è¨Š");

            // è™•ç† API Key è¨˜æ†¶
            if (document.getElementById("remember-me").checked) localStorage.setItem("gemini_api_key", apiKey);
            else localStorage.removeItem("gemini_api_key");

            targetDrawCount = parseInt(document.getElementById("spread-type").value);
            selectedIndices = [];
            // ç”Ÿæˆä¸¦æ´—ç‰Œ
            shuffledIndices = Array.from({length: 78}, (_, i) => i).sort(() => 0.5 - Math.random());

            document.getElementById("setup-page").classList.remove("active");
            document.getElementById("drawing-page").classList.add("active");

            initResponsiveDeck();
        }

        /* --- æ ¸å¿ƒé‚è¼¯ï¼šå‹•æ…‹ç”Ÿæˆå¼§å½¢ç‰Œå † (å«å¤šå±¤ç´šé©é…) --- */
        
        function initResponsiveDeck() {
            const container = document.getElementById("deck-container");
            container.innerHTML = "";
            const totalCards = 78;
            const winW = window.innerWidth;
            const isMobile = winW < 600;

            // RWD ç‰©ç†åƒæ•¸è¨­å®š
            let numTiers = isMobile ? 3 : 2; // æ‰‹æ©Ÿç‰ˆåˆ† 3 å±¤é¿å…å¤ªæ“ 
            let cardW = isMobile ? 55 : 80;
            let cardH = isMobile ? 85 : 125;
            let radius = isMobile ? 300 : 500; 
            let angleRange = isMobile ? 65 : 80; // å±•é–‹è§’åº¦é™åˆ¶ï¼Œé˜²æ­¢è²¼é‚Š
            
            const cardsPerTier = Math.ceil(totalCards / numTiers);

            for (let i = 0; i < totalCards; i++) {
                const tier = Math.floor(i / cardsPerTier);
                const idxInTier = i % cardsPerTier;
                
                const card = document.createElement("div");
                card.className = "card-back-item";
                card.style.width = cardW + "px"; 
                card.style.height = cardH + "px";
                
                // è¨ˆç®—æ¯å¼µç‰Œçš„æ—‹è½‰è§’åº¦
                const startAngle = -(angleRange / 2);
                const angle = startAngle + (idxInTier * (angleRange / (cardsPerTier - 1)));
                
                // ç‰©ç†å±¤æ¬¡æ„Ÿè¨­å®š (å‚ç›´åç§»èˆ‡åŠå¾‘å¾®èª¿)
                const tierYOffset = tier * (isMobile ? 145 : 180); 
                const tierRadius = radius - (tier * 15);
                
                card.style.transformOrigin = `center ${tierRadius}px`;
                card.style.top = tierYOffset + "px";
                card.style.transform = `rotate(${angle}deg)`;
                
                // å›ºå®š Z-indexï¼šå¾Œæ’ä¸æœƒæ“‹ä½å‰æ’ï¼Œé¸ä¸­ä¹Ÿä¸æœƒæµ®èµ·
                card.style.zIndex = 10 + tier;

                // é»æ“Šäº‹ä»¶ï¼šé¸å–æˆ–å–æ¶ˆé¸å–
                card.onclick = () => {
                    const realIdx = shuffledIndices[i];
                    if (selectedIndices.includes(realIdx)) {
                        selectedIndices = selectedIndices.filter(v => v !== realIdx);
                        card.classList.remove("selected");
                    } else if (selectedIndices.length < targetDrawCount) {
                        selectedIndices.push(realIdx);
                        card.classList.add("selected");
                    }
                    document.getElementById("drawing-status").innerText = `å·²é¸å– ${selectedIndices.length} / ${targetDrawCount}`;
                    
                    // æŠ½æ»¿å¾Œè‡ªå‹•å»¶é²å½ˆçª—ç¢ºèª
                    if (selectedIndices.length === targetDrawCount) {
                        setTimeout(() => { document.getElementById("confirm-modal").style.display = "flex"; }, 300);
                    }
                };
                container.appendChild(card);
            }
            document.getElementById("drawing-status").innerText = `è«‹é¸å– ${targetDrawCount} å¼µç‰Œ`;
        }

        /* --- ç¢ºèªé€£ç·šä¸¦åŸ·è¡Œ API å‘¼å« --- */
        async function confirmAndInterpret() {
            const btn = document.getElementById("modal-confirm-btn");
            const cancelBtn = document.getElementById("modal-cancel-btn");
            const loader = document.getElementById("modal-loader");
            const text = document.getElementById("modal-text");

            // UI åˆ‡æ›è‡³è¼‰å…¥ç‹€æ…‹
            btn.disabled = true; 
            btn.style.display = "none";
            cancelBtn.style.display = "none";
            loader.style.display = "block";
            text.innerText = "è§£è®€éˆé­‚è¨Šæ¯ä¸­ï¼Œè«‹ä¿æŒå¹³éœ...";

            // ç¢ºå®šç‰Œé¢èˆ‡æ­£é€†ä½
            const finalCards = selectedIndices.map(idx => ({ 
                name: FULL_DECK[idx], 
                direction: Math.random() > 0.5 ? "æ­£ä½" : "é€†ä½" 
            }));
            
            // åŸ·è¡ŒéåŒæ­¥ API å‘¼å« (å®Œå…¨åŒæ­¥ç­‰å¾…çµæœ)
            const success = await callGemini(finalCards);

            if (success) {
                closeModal();
                document.getElementById("drawing-page").classList.remove("active");
                document.getElementById("result-page").classList.add("active");
            } else {
                alert("æ„Ÿæ‡‰ä¸­æ–·ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
                btn.disabled = false; 
                btn.style.display = "inline-block";
                cancelBtn.style.display = "inline-block";
                loader.style.display = "none";
                text.innerText = "API é€£ç·šå¤±æ•—ï¼Œè«‹é‡è©¦ã€‚";
            }
        }

        /* --- API é€šè¨Šé‚è¼¯ï¼šå°æ¥ Gemini-2.5-flash --- */
        async function callGemini(cards) {
            const apiKey = document.getElementById("api-key").value.trim();
            const question = document.getElementById("user-question").value.trim();
            const cardsStr = cards.map(c => `${c.name}(${c.direction})`).join(",");
            const spreadName = cards.length === 3 ? "è–ä¸‰è§’" : "å–®ç‰ŒæŒ‡å¼•";
            
            // è«‹æ±‚ç¶²å€ (æŒ‡å®š 2.5-flash æ¨¡å‹)
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
            
            // çµæ§‹åŒ– Prompt ç¢ºä¿å›å‚³ JSON
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆæ¥­å¡”ç¾…å åœå¸«ã€‚
                é‡å°å•é¡Œï¼š${question}ï¼Œç‰Œé™£ï¼š${spreadName}ï¼ŒæŠ½ç‰Œï¼š${cardsStr} é€²è¡Œè§£æã€‚
                è«‹åš´æ ¼éµå®ˆ JSON æ ¼å¼èˆ‡å­—æ•¸é™åˆ¶ï¼š
                1. individual_interpretations çš„ text: æ¯å¼µç‰Œè§£é‡‹ç´„ 70-85 å­—ã€‚
                2. conclusion: ç¶œåˆè§£æç´„ 250 å­—ã€‚
                3. advice: æä¾›ç´„ 100 å­—å»ºè­°ã€‚
                å›å‚³æ ¼å¼ï¼š{"individual_interpretations":[{"name":"ç‰Œå","text":"è§£æ"}],"conclusion":"ç¸½çµ","advice":"å»ºè­°"}
            `;

            try {
                const res = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prompt }] }], 
                        generationConfig: { responseMimeType: "application/json" } 
                    })
                });

                if (!res.ok) {
                    const errorMsg = await res.json();
                    console.error("API å›å‚³éŒ¯èª¤:", errorMsg);
                    return false;
                }

                const data = await res.json();
                const jsonText = data.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);
                
                // æ¸²æŸ“ UI (æ­¤æ™‚åœ¨èƒŒæ™¯æ¸²æŸ“å®Œæˆ)
                updateResultUI(parsedJson, cards);
                return true;
            } catch (e) { 
                console.error("è§£æéç¨‹å‡ºéŒ¯:", e); 
                return false; 
            }
        }

        /* --- çµæœé æ¸²æŸ“é‚è¼¯ --- */
        function updateResultUI(json, cards) {
            const display = document.getElementById("card-display");
            display.innerHTML = "";
            
            // ç‰Œåå°æ‡‰è‹±æ–‡ï¼ˆç”¨æ–¼åœ–æª”è·¯å¾‘ï¼‰
            const majorEng = ["TheFool", "TheMagician", "TheHighPriestess", "TheEmpress", "TheEmperor", "TheHierophant", "TheLovers", "TheChariot", "Strength", "TheHermit", "WheelOfFortune", "Justice", "TheHangedMan", "Death", "Temperance", "TheDevil", "TheTower", "TheStar", "TheMoon", "TheSun", "Judgement", "TheWorld"];
            const suitMap = { "æ¬Šæ–": "Wands", "è–æ¯": "Cups", "å¯¶åŠ": "Swords", "éŒ¢å¹£": "Pentacles" };
            const rankList = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å", "ä¾è€…", "é¨å£«", "çš‡å", "åœ‹ç‹"];

            cards.forEach((c, i) => {
                // è¨ˆç®—åœ–æª”åç¨±
                let fileName = MAJOR_ARCANA.includes(c.name) 
                    ? `${MAJOR_ARCANA.indexOf(c.name).toString().padStart(2, '0')}-${majorEng[MAJOR_ARCANA.indexOf(c.name)]}.jpg`
                    : `${suitMap[c.name.substring(0,2)]}${(rankList.indexOf(c.name.substring(2))+1).toString().padStart(2, '0')}.jpg`;

                const el = document.createElement("div");
                el.className = "tarot-card";
                el.onclick = () => toggleCard(el);
                
                // å¡«å……å–®å¡å…§å®¹
                el.innerHTML = `
                    <img src="Cards/${fileName}" class="${c.direction==='é€†ä½'?'is-reversed':''}">
                    <div class="card-content">
                        <div class="card-title" style="font-size:1.5em; font-weight:900; color:var(--gold);">${c.name}</div>
                        <div style="color:#ff4d4d; font-weight:bold;">(${c.direction})</div>
                        <div class="card-interpretation">${marked.parse(json.individual_interpretations[i].text)}</div>
                    </div>`;
                display.appendChild(el);
            });

            // å¡«å……åº•éƒ¨ç¸½çµèˆ‡å»ºè­°
            document.getElementById("interpretation-area").innerHTML = `
                <div class="section-header">ğŸ”® å åœç¸½çµ</div>${marked.parse(json.conclusion)}
                <div class="section-header">ğŸ’¡ éˆé­‚å»ºè­°</div>${marked.parse(json.advice)}`;
        }
    </script>
</body>
</html>